(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[827],{8452:function(e,t,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/basket/checkout",function(){return c(605)}])},3771:function(e,t,c){"use strict";function n(e){return{type:"SET_PRODUCT_TO_BASKET",item:e}}function r(e,t){return{type:"EDIT_PRODUCT_COUNT",id:e,qty:t}}function a(e){return{type:"DELETE_PRODUCT",id:e}}function s(){return{type:"RESET_PRODUCT"}}c.d(t,{Ir:function(){return a},gn:function(){return n},k:function(){return r},ms:function(){return s}})},605:function(e,t,c){"use strict";c.r(t),c.d(t,{default:function(){return _}});var n=c(5893),r=c(7294),a=c(9473),s=c(3771),l=c(9839);let u=e=>{let{classes:t="",children:c,...a}=e,s=r.Children.map(c,e=>r.isValidElement(e)?r.cloneElement(e,{...a}):e);return(0,n.jsx)("div",{className:t,children:s})};var i=c(6331);let o=e=>{let{setDataForm:t,dataForm:c,nameForm:a,errorForm:s,children:l,onChanges:u,...i}=e,{name:o,required:d,...m}=i,[h,_]=(0,r.useState)(!1),f=s[o],p=s[o]?" form-input__error":"",x=a+"-"+o,k=(0,r.useRef)(null),y=()=>{let e=c;e[k.current.name]={type:k.current.type,name:k.current.name,value:k.current.value,required:k.current.required},t(e)},j=()=>{let e=c;delete e[o],t(e)},v=e=>{let n=c;n[e.target.name]={type:e.target.type,name:e.target.name,value:e.target.value,required:e.target.required},t(e=>({...e,...n})),u&&u(e),_(!!e.target.value.length)},g=()=>{if(f){let e=f.customText?f.customText:"Заполните поле";return(0,n.jsx)("span",{className:"form-input__error-text",children:e})}};return(0,r.useEffect)(()=>(y(),()=>{j()}),[]),(0,n.jsxs)("div",{className:"form-input",children:[(0,n.jsx)("textarea",{className:(h?"focused":"")+p,name:o,id:x,required:d,onChange:v,ref:k,...m}),l&&(0,n.jsxs)("label",{htmlFor:x,children:[l,d&&" *"]}),(0,n.jsx)(g,{})]})},d=e=>{let{num:t,setDataForm:c,dataForm:a,nameForm:s,errorForm:l,children:u,onChanges:i,...o}=e,{name:d,required:m,...h}=o,_=l[d],f=l[d]?" form-input__error":"";t=t?"-"+t:"";let p=s+"-"+d+t,x=(0,r.useRef)(null),k=()=>{let e=a;x.current.checked&&(e[x.current.name]={type:x.current.type,name:x.current.name,value:x.current.defaultValue},c(e))},y=()=>{let e=a;delete e[d],c(e)},j=e=>{let t=a;t[e.target.name]={type:e.target.type,name:e.target.name,value:e.target.value},c(e=>({...e,...t})),i&&i(e)},v=()=>{if(_){let e=_.customText?_.customText:"Заполните поле";return(0,n.jsx)("span",{className:"form-input__error-text",children:e})}};return(0,r.useEffect)(()=>(k(),()=>{y()}),[]),(0,n.jsxs)("div",{className:"form-radio",children:[(0,n.jsx)("input",{type:"radio",className:f,name:d,id:p,required:m,onChange:j,ref:x,...h}),u&&(0,n.jsxs)("label",{htmlFor:p,children:[u,m&&" *"]}),(0,n.jsx)(v,{})]})},m=e=>{let{num:t,setDataForm:c,dataForm:a,nameForm:s,errorForm:l,children:u,onChanges:i,...o}=e,{name:d,required:m,...h}=o,_=l[d],f=l[d]?" form-input__error":"";t=t?"-"+t:"";let p=s+"-"+d+t,x=(0,r.useRef)(null),k=()=>{let e=a;x.current.checked&&(e[x.current.name]={type:x.current.type,name:x.current.name,value:x.current.defaultValue,required:x.current.required,checked:x.current.checked},c(e))},y=()=>{let e=a;delete e[d],c(e)},j=e=>{let t=a;t[e.target.name]={type:e.target.type,name:e.target.name,value:e.target.value,required:e.target.required,checked:e.target.checked},c(e=>({...e,...t})),i&&i(e)},v=()=>{if(_){let e=_.customText?_.customText:"Заполните поле";return(0,n.jsx)("span",{className:"form-input__error-text",children:e})}};return(0,r.useEffect)(()=>(k(),()=>{y()}),[]),(0,n.jsxs)("div",{className:"form-checkbox",children:[(0,n.jsx)("input",{type:"checkbox",className:f,name:d,id:p,required:m,onChange:j,ref:x,...h}),u&&(0,n.jsxs)("label",{htmlFor:p,children:[u,m&&" *"]}),(0,n.jsx)(v,{})]})},h=()=>{let e=(0,a.I0)(),t=(0,a.v9)(e=>e.basket.items),c=(0,a.v9)(e=>e.users.users),h=(0,a.v9)(e=>e.authentication.id),_=h?c.find(e=>e.id===h):{},[f,p]=(0,r.useState)(!1),[x,k]=(0,r.useState)(!1),[y,j]=(0,r.useState)([]),v=t.reduce((e,t)=>e+t.price*t.qty,0),g=async e=>{j([]);let t=await Promise.all(e.map(async e=>{try{let t="https://api.punkapi.com/v2/beers/".concat(e.id),c=await fetch(t),n=await c.json(),r={id:n[0].id,name:n[0].name,price:n[0].ibu,image_url:n[0].image_url,qty:e.qty};return r}catch(a){console.log(a)}}));j(t)},b=()=>y.map(e=>"- Название: ".concat(e.name,"; Цена: ").concat(e.price,"$; Количество: ").concat(e.qty," шт.; Сумма: ").concat(e.price*e.qty,"$ \n")).join(""),q=t=>{e((0,s.ms)());let c=t.type_client?"Тип клиента: ".concat(t.type_client):"",n=t.name?"ФИО: ".concat(t.name):"",r=t.phone?"Телефон: ".concat(t.phone):"",a=t.email?"Email: ".concat(t.email):"",l=t.type_payment?"Способ оплаты: ".concat(t.type_payment):"",u=t.type_delivery?"Способ доставки: ".concat(t.type_delivery):"",i=t.delivery_address?"Адрес доставки: ".concat(t.delivery_address):"",o=y?"Список товаров:\n\n".concat(b()):"",d='\nПредставим что это пришло на почту\n\nФорма "Оформление заказа"\n'.concat(c,"\n").concat(n,"\n").concat(r,"\n").concat(a,"\n").concat(l,"\n").concat(u,"\n").concat(i,"\n-----------\n").concat(o,"\n").concat("Общая сумма: ".concat(v,"$"),"\n        ");console.log(d),k(!0)},N=()=>(0,n.jsxs)("div",{className:"form-success form-success--checkout",children:[(0,n.jsx)("div",{className:"form-success__title",children:"Спасибо за покупку"}),(0,n.jsx)("div",{className:"form-success__text",children:"Мы свяжемся с вами в ближайшее время."})]});return(0,r.useEffect)(()=>{g(t)},[t.length]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:"page-title",children:"Оформление заказа"}),(()=>{if(!t.length&&!x)return(0,n.jsx)("p",{children:"Корзина пуста"});{let e=h?_.name:"",c=h?_.phone:"",r=h?_.email:"";return(0,n.jsx)("div",{className:"checkout",children:(0,n.jsxs)(l.Z,{nameForm:"checkout",successText:N,sendMessage:q,textBtn:"Оформить заказ",children:[(0,n.jsxs)(u,{classes:"checkout-form__block",children:[(0,n.jsx)(u,{classes:"checkout-form__block-title",children:"Тип покупателя"}),(0,n.jsxs)(u,{classes:"checkout-form__block-radio",children:[(0,n.jsx)(d,{num:1,name:"type_client",value:"Физическое лицо",defaultChecked:!0,children:"Физическое лицо"}),(0,n.jsx)(d,{num:2,name:"type_client",value:"Юридическое лицо",children:"Юридическое лицо"})]})]}),(0,n.jsxs)(u,{classes:"checkout-form__block",children:[(0,n.jsx)(u,{classes:"checkout-form__block-title",children:"Способ доставки"}),(0,n.jsxs)(u,{classes:"checkout-form__block-radio",children:[(0,n.jsx)(d,{num:1,name:"type_delivery",value:"Самовывоз",defaultChecked:!0,onChanges:()=>p(!1),children:"Самовывоз"}),(0,n.jsx)(d,{num:2,name:"type_delivery",value:"Доставка курьером",onChanges:()=>p(!0),children:"Доставка курьером"})]}),f&&(0,n.jsx)(o,{name:"delivery_address",required:!0,rows:4,children:"Адрес доставки"})]}),(0,n.jsxs)(u,{classes:"checkout-form__block",children:[(0,n.jsx)(u,{classes:"checkout-form__block-title",children:"Способ оплаты"}),(0,n.jsxs)(u,{classes:"checkout-form__block-radio",children:[(0,n.jsx)(d,{num:1,name:"type_payment",value:"Наличный расчет",defaultChecked:!0,children:"Наличный расчет"}),(0,n.jsx)(d,{num:2,name:"type_payment",value:"Безналичный расчет",children:"Безналичный расчет"})]})]}),(0,n.jsxs)(u,{classes:"checkout-form__block",children:[(0,n.jsx)(u,{classes:"checkout-form__block-title",children:"Данные покупателя"}),(0,n.jsx)(i.Z,{name:"name",defaultValue:e,children:"Ваше ФИО"}),(0,n.jsx)(i.Z,{type:"phone",name:"phone",mask:"+7 (999) 999-99-99",required:!0,defaultValue:c,children:"Ваш телефон"}),(0,n.jsx)(i.Z,{type:"email",name:"email",required:!0,defaultValue:r,children:"Ваш e-mail"})]}),(0,n.jsxs)(u,{classes:"checkout-form__block checkout-form__block--total",children:["Итого: ",v,"$"]}),(0,n.jsx)(u,{classes:"checkout-form__block checkout-form__block--policy",children:(0,n.jsx)(m,{name:"policy",value:"Согласие",defaultChecked:!0,required:!0,children:"Подтвердите согласие на обработку персональных данных"})})]})})}})()]})};var _=h}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8452)}),_N_E=e.O()}]);